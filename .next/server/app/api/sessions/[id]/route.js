"use strict";(()=>{var e={};e.id=241,e.ids=[241],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},93977:e=>{e.exports=require("node:fs/promises")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},35515:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>x,patchFetch:()=>q,requestAsyncStorage:()=>y,routeModule:()=>w,serverHooks:()=>S,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>h});var s={};r.r(s),r.d(s,{DELETE:()=>m,GET:()=>p});var n=r(95419),i=r(69108),a=r(99678),o=r(78070),l=r(81355),d=r(82002),u=r(19631),c=r(92373);async function p(e,{params:t}){try{let e=await (0,l.getServerSession)(d.L);if(!e?.user?.id)return o.Z.json({error:"Unauthorized"},{status:401});let r=await u._.session.findFirst({where:{id:t.id,userId:e.user.id,deletedAt:null},include:{persona:{select:{id:!0,label:!0,ageNumber:!0}},messages:{orderBy:{createdAt:"asc"}},artifacts:{orderBy:{createdAt:"asc"}}}});if(!r)return o.Z.json({error:"Session not found"},{status:404});let s=await Promise.all(r.artifacts.map(async e=>({...e,url:await c.H.getSignedDownloadUrl(e.storageKey)})));return o.Z.json({session:{...r,artifacts:s}})}catch(e){return console.error("[Session] Get error:",e),o.Z.json({error:"Failed to fetch session"},{status:500})}}async function m(e,{params:t}){try{let e=await (0,l.getServerSession)(d.L);if(!e?.user?.id)return o.Z.json({error:"Unauthorized"},{status:401});let r=await u._.session.findFirst({where:{id:t.id,userId:e.user.id,deletedAt:null},include:{artifacts:!0}});if(!r)return o.Z.json({error:"Session not found"},{status:404});let s=r.artifacts.map(e=>e.storageKey);return await u._.session.update({where:{id:t.id},data:{deletedAt:new Date}}),await c.H.deleteFiles(s),o.Z.json({success:!0})}catch(e){return console.error("[Session] Delete error:",e),o.Z.json({error:"Failed to delete session"},{status:500})}}let w=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/sessions/[id]/route",pathname:"/api/sessions/[id]",filename:"route",bundlePath:"app/api/sessions/[id]/route"},resolvedPagePath:"C:\\Users\\mrted\\talk-to-your-inner-self\\src\\app\\api\\sessions\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:g,serverHooks:S,headerHooks:f,staticGenerationBailout:h}=w,x="/api/sessions/[id]/route";function q(){return(0,a.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:g})}},82002:(e,t,r)=>{r.d(t,{L:()=>o});var s=r(86485),n=r(6521),i=r.n(n),a=r(19631);let o={providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Missing credentials");let t=await a._.user.findUnique({where:{email:e.email}});if(!t||t.deletedAt||!await i().compare(e.password,t.password))throw Error("Invalid credentials");return{id:t.id,email:t.email}}})],session:{strategy:"jwt",maxAge:2592e3},pages:{signIn:"/auth/signin"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e),session:async({session:e,token:t})=>(e.user&&(e.user.id=t.id),e)},secret:process.env.NEXTAUTH_SECRET}},19631:(e,t,r)=>{r.d(t,{_:()=>n});let s=require("@prisma/client"),n=globalThis.prisma??new s.PrismaClient({log:["error"]})},92373:(e,t,r)=>{r.d(t,{H:()=>w});let s=require("@aws-sdk/client-s3");var n=r(54363);let i={region:process.env.AWS_REGION||"us-east-1",credentials:{accessKeyId:process.env.AWS_ACCESS_KEY_ID||"",secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY||""},...process.env.AWS_S3_ENDPOINT&&{endpoint:process.env.AWS_S3_ENDPOINT}},a=new s.S3Client(i),o=process.env.AWS_S3_BUCKET||"inner-self-media",l=parseInt(process.env.SIGNED_URL_EXPIRY_SECONDS||"3600",10);async function d(e,t){let r=new s.PutObjectCommand({Bucket:o,Key:e,ContentType:t});return(0,n.e)(a,r,{expiresIn:l})}async function u(e){let t=new s.GetObjectCommand({Bucket:o,Key:e});return(0,n.e)(a,t,{expiresIn:l})}async function c(e){let t=new s.DeleteObjectCommand({Bucket:o,Key:e});await a.send(t)}async function p(e,t,r){let n=new s.PutObjectCommand({Bucket:o,Key:e,Body:t,ContentType:r});await a.send(n)}class m{async getSignedUploadUrl(e,t){return d(e,t)}async getSignedDownloadUrl(e){return u(e)}async uploadFile(e,t,r){return p(e,t,r)}async deleteFile(e){try{await c(e),console.log(`[Storage] Deleted: ${e}`)}catch(t){console.error(`[Storage] Failed to delete ${e}:`,t)}}async deleteFiles(e){let t=(await Promise.allSettled(e.map(e=>this.deleteFile(e)))).filter(e=>"rejected"===e.status);t.length>0&&console.warn(`[Storage] Failed to delete ${t.length} of ${e.length} files`)}}let w=new m}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,914,123,70,363],()=>r(35515));module.exports=s})();